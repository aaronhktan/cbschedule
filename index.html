<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="description" content="Change your settings for the CB Schedule pebble app."></meta>
		<title>CB Schedule Manager</title>
		<link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHZpZXdCb3g9IjAgMCA4IDgiPgogIDxwYXRoIGQ9Ik01LjUgMGMtMS4zOCAwLTIuNSAxLjEyLTIuNSAyLjUgMCAuMTYgMCAuMzIuMDMuNDdsLTMuMDMgMy4wM3YyaDN2LTJoMnYtMWwuMDMtLjAzYy4xNS4wMy4zMS4wMy40Ny4wMyAxLjM4IDAgMi41LTEuMTIgMi41LTIuNXMtMS4xMi0yLjUtMi41LTIuNXptLjUgMWMuNTUgMCAxIC40NSAxIDFzLS40NSAxLTEgMS0xLS40NS0xLTEgLjQ1LTEgMS0xeiIgLz4KPC9zdmc+"</link>
		<link href='https://fonts.googleapis.com/css?family=Roboto:300,700,400' rel='stylesheet' type='text/css'>
		<link href="css/main.css" rel="stylesheet"></link>
	</head>
	<body onload="loadSettings()">
		
		<div id="title">
			<p>CB Schedule Manager</p>
		</div>
		<div class="input-title">
			<strong>Period 1A</strong>
			<input id="period-1a-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 1B</strong>
			<input id="period-1b-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 1C</strong>
			<input id="period-1c-input" type="text" onblur="this.value=removeSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 1D</strong>
			<input id="period-1d-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 2A</strong>
			<input id="period-2a-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 2B</strong>
			<input id="period-2b-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 2C</strong>
			<input id="period-2c-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div class="input-title">
			<strong>Period 2D</strong>
			<input id="period-2d-input" type="text" onblur="this.value=trimSpaces(this.value);">
			</input>
		</div>
		<div id="savebutton">
			<input id="submit_button" type="button" value="Save">
		</div>
		<script>
		  // Get a handle to the button's HTML element
		  var submitButton = document.getElementById('submit_button');
		
		  // Add a 'click' listener
		  submitButton.addEventListener('click', function() {
		    // Get the config data from the UI elements
		    var onea = document.getElementById('period-1a-input').value;
		    var oneb = document.getElementById('period-1b-input').value;
		    var onec = document.getElementById('period-1c-input').value;
		    var oned = document.getElementById('period-1d-input').value;
		    var twoa = document.getElementById('period-2a-input').value;
		    var twob = document.getElementById('period-2b-input').value;
		    var twoc = document.getElementById('period-2c-input').value;
		    var twod = document.getElementById('period-2d-input').value;
		
		    // Make a data object to be sent, coercing value types to integers
		    var options = {
		      'onea': onea,
		      'oneb': oneb,
		      'onec': onec,
		      'oned': oned,
		      'twoa': twoa,
		      'twob': twob,
		      'twoc': twoc,
		      'twod': twod
		    };
		
		    // Determine the correct return URL (emulator vs real watch)
		    function getQueryParam(variable, defaultValue) {
		      var query = location.search.substring(1);
		      var vars = query.split('&');
		      for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (pair[0] === variable) {
		          return decodeURIComponent(pair[1]);
		        }
		      }
		      return defaultValue || false;
		    }
		    var return_to = getQueryParam('return_to', 'pebblejs://close#');
		
		    // Encode and send the data when the page closes
		    document.location = return_to + encodeURIComponent(JSON.stringify(options));
		  });

		function trimSpaces(value){
			s = value;
			s = s.replace(/(^\s*)|(\s*$)/gi,"");
			s = s.replace(/[ ]{2,}/gi," ");
			s = s.replace(/\n /,"\n");
			return s
		};
		
		function updateControls() {
			var onea = decodeURIcomponent($.urlParam("onea"));
			if (onea != "") {
				document.getElementById('period-1a-input').value = onea;
			}
			var oneb = decodeURIcomponent($.urlParam("oneb"));
			if (oneb != "") {
				document.getElementById('period-1b-input').value = oneb;
			}
			var onec = decodeURIcomponent($.urlParam("onec"));
			if (onec != "") {
				document.getElementById('period-1c-input').value = onec;
			}
			var oned = decodeURIcomponent($.urlParam("oned"));
			if (oned != "") {
				document.getElementById('period-1d-input').value = oned;
			}
			var twoa = decodeURIcomponent($.urlParam("twoa"));
			if (twoa != "") {
				document.getElementById('period-2a-input').value = twoa;
			}
			var twob = decodeURIcomponent($.urlParam("twob"));
			if (twob != "") {
				document.getElementById('period-2b-input').value = twob;
			}
			var twoc = decodeURIcomponent($.urlParam("twoc"));
			if (twoc != "") {
				document.getElementById('period-2c-input').value = twoc;
			}
			var twod = decodeURIcomponent($.urlParam("twod"));
			if (twod != "") {
				document.getElementById('period-2d-input').value = twod;
			}
		};
		
		function queryPeriods(paramName) {
		    url = window.location.search.substring(1);
		    params = url.split("&");
		
		    for (i=0; i<params.length; i++) {
		        param = params[i].split("=");
		        if (param[0] == paramName) {
		            return param[1];
		        }
	        	else if (window.location.search.substring(1).prototype.indexOf(paramName) = -1) {
	        		return "";
		        }
		    }
		};
		
		function loadSettings() {
			document.getElementById('period-1a-input').value = queryPeriods("onea")
			document.getElementById('period-1b-input').value = queryPeriods("oneb")
			document.getElementById('period-1c-input').value = queryPeriods("onec")
			document.getElementById('period-1d-input').value = queryPeriods("oned")
			document.getElementById('period-2a-input').value = queryPeriods("twoa")
			document.getElementById('period-2b-input').value = queryPeriods("twob")
			document.getElementById('period-2c-input').value = queryPeriods("twoc")
			document.getElementById('period-2d-input').value = queryPeriods("twod")
		}
		
		</script>
	</body>
</html>
