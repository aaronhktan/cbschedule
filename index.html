<!DOCTYPE html>
 <html>
 	<head>
 		<meta charset="utf-8">
 		<meta name="description" content="Change your settings for the CB Schedule pebble app."/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
 		<title>CB Schedule Manager</title>
 		<link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHZpZXdCb3g9IjAgMCA4IDgiPgogIDxwYXRoIGQ9Ik01LjUgMGMtMS4zOCAwLTIuNSAxLjEyLTIuNSAyLjUgMCAuMTYgMCAuMzIuMDMuNDdsLTMuMDMgMy4wM3YyaDN2LTJoMnYtMWwuMDMtLjAzYy4xNS4wMy4zMS4wMy40Ny4wMyAxLjM4IDAgMi41LTEuMTIgMi41LTIuNXMtMS4xMi0yLjUtMi41LTIuNXptLjUgMWMuNTUgMCAxIC40NSAxIDFzLS40NSAxLTEgMS0xLS40NS0xLTEgLjQ1LTEgMS0xeiIgLz4KPC9zdmc+"/>
 		<link href='https://fonts.googleapis.com/css?family=Roboto:300,700,400' rel='stylesheet' type='text/css'>
 		<link href="css/main.css" rel="stylesheet" type="text/css"/>
 	</head>
 	<body onLoad=clickThings()>
 		<div id="title">
 			<p>CB Schedule Manager</p>
 		</div>
 		<div id ="description">
 			<p>Fill out as many or as few of these as you want. No need to worry about filling them all out!</p>
 		</div>
 		<div id="inputs0">
 			<div class="form">
	 			<strong>Period 1A</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 1B</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>					
				<br><br> <strong>Period 1C</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 1D</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 2A</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 2B</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 2C</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br> <strong>Period 2D</strong>
					<br>Course:<br>
						<input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/>
					<br>Course Code:<br>
						<input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Teacher:<br>
						<input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/>
					<br>Room:<br>
						<input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/>
				<br><br>
			</div>
		</div>
		 <div id="savebutton">
			<br><button id="submit_button" class="button">Save</button>
 		</div>
		<div id="addbutton">
			<br><button id="add_button" class="button" onClick=addInput("inputs0")>Add another schedule</button>
		</div>
 		<div id="removebutton">
 			<br><button id="remove_button" class="button" onClick=removeInput() disabled=true>Remove a schedule</button>
 		</div>
 		<script type="text/javascript">
 		  	// Get a handle to the button's HTML element
 		  	var submitButton = document.getElementById('submit_button');
 		
 		  	// Add a 'click' listener
 		  	submitButton.addEventListener('click', function() {
 		    	
 		    	// Get the config data from the UI elements
	 		    var classes = document.getElementsByClassName('class');
	 		    var codes = document.getElementsByClassName('code');
	 		    var names = document.getElementsByClassName('name');
	 		    var teachers = document.getElementsByClassName('teacher');
	 		    var rooms = document.getElementsByClassName('room');
	 		    var usernames = document.getElementsByClassName('username');
	 		    var options = [];
	 		    for (i = 0; i < classes.length; i++) {
	 		    	var period = new createPeriod(classes[i].value, codes[i].value, teachers[i].value, rooms[i].value);
	 		    	options[i] = period;
	 		    }
	 		    for (i = 0; i < counter; i++) {
	 		    	options[(counter + 1) * 8 + i] = usernames[i].value;
	 		    }
	 		    options[(counter + 1) * 8 + counter] = counter;
 		
	 		    // Determine the correct return URL (emulator vs real watch)
	 		    function getQueryParam(variable, defaultValue) {
	 		      var query = location.search.substring(1);
	 		      var vars = query.split('&');
	 		      for (var i = 0; i < vars.length; i++) {
	 		        var pair = vars[i].split('=');
	 		        if (pair[0] === variable) {
	 		          return decodeURIComponent(pair[1]);
	 		        }
	 		      }
	 		      return defaultValue || false;
	 		    }
	 		    var return_to = getQueryParam('return_to', 'pebblejs://close#');
	 		
	 		    // Encode and send the data when the page closes
	 		    document.location = return_to + encodeURIComponent(JSON.stringify(options));
 		  })

			function removeSpaces(string) {
	 			s = string;
				s = s.replace(/(^\s*)|(\s*$)/gi,"");
				s = s.replace(/[ ]{2,}/gi," ");
				s = s.replace(/\n /,"\n");
				return s
			}

			var counter = 0;
			var users = 0;

			function clickThings() {
				url = window.location.search.substring(1); 			//Searches the URL for the element number
				if (url.search("users") != -1) { 					//If the URL has the string "numbers"
					params = url.split("&"); 						//Creates an array with each element being separated by "&"
					for (x = 0; x < params.length; x++) { 			//Checks each element
						param = params[x].split("="); 				//Splits up each parameter in URL by "="
					        if (param[0] == "users") { 				//If the first part of the paramater is equal to "users"
					        	users = parseInt(param[1]);			//The number of users is set to the second part of the parameter.
					        }
					}
				}
				else {
					users = 0;
				}
				for (i=1; i<=users; i++) {
					addInput("inputs0");
				}
				
				var names = document.getElementsByClassName('username');
				for (i = 0; i < names.length; i++) { 													//Cycles through elements in that array
					url = window.location.search.substring(1); 											//Searches the URL for the element number
					if (url.search('user' + i.toString()) != -1) { 															//If the URL has a number
						params = url.split("&"); 														//Creates an array with each element being separated by "&"
						for (x = 0; x < params.length; x++) { 											//Checks each element
							param = params[x].split("="); 												//Splits up each parameter in URL by "="
						        if (param[0] == ('user' + i.toString())) { 											//If the first part of the paramater is equal to the element number
						        	names[i].value = decodeURIComponent(param[1]);						//The element's value is set to the second part of the parameter.
						        }
						}
					}
					else {
						names[i].value = "";
					}
				}

				var inputs = document.getElementsByTagName('input');
				var classes = document.getElementsByClassName('class');
	 		    var codes = document.getElementsByClassName('code');
	 		    var teachers = document.getElementsByClassName('teacher');
	 		    var rooms = document.getElementsByClassName('room');
				var notUserNames = []
				for (i = 0; i < inputs.length; i += 4) {
					notUserNames[i] = classes[i / 4];
					notUserNames[i + 1] = codes[i / 4];
					notUserNames[i + 2] = teachers[i / 4];
					notUserNames[i + 3] = rooms[i / 4];
				}
				for (i = 0; i < notUserNames.length; i++) { 													//Cycles through elements in that array
					url = window.location.search.substring(1); 											//Searches the URL for the element number
					if (url.search(i) != -1) { 															//If the URL has a number
						params = url.split("&"); 														//Creates an array with each element being separated by "&"
						for (x = 0; x < params.length; x++) { 											//Checks each element
							param = params[x].split("="); 												//Splits up each parameter in URL by "="
						        if (param[0] == parseInt(i)) { 											//If the first part of the paramater is equal to the element number
						        	notUserNames[i].value = decodeURIComponent(param[1]);						//The element's value is set to the second part of the parameter.
						        }
						}
					}
					else {
						notUserNames[i].value = "";
					}
				}
			}

			var titleDiv = [];
			var formDiv = [];
			function addInput(divName) {
				counter ++;

				//Create div for title
				titleDiv[counter] = document.createElement('div');
				titleDiv[counter].setAttribute('class', 'title');
				titleDiv[counter].setAttribute('id', 'title' + counter);
				titleDiv[counter].innerHTML = "<br><br><strong>Friend #</strong>" + counter + '<br>Name:<br><input class="username" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br>';

				//Create div for text input
				formDiv[counter] = document.createElement('div');
				formDiv[counter].setAttribute('class', 'form');
				formDiv[counter].setAttribute('id', 'form' + counter);
				formDiv[counter].innerHTML = '<strong>Period 1A</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 1B</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 1C</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 1D</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 2A</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 2B</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 2C</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br><strong>Period 2D</strong><br>Course:<br><input class="class" type="text" onblur="this.value=removeSpaces(this.value);"/><br>Course Code:<br><input class="code" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Teacher:<br><input class="teacher" type="text" onblur="this.value=removeSpaces(this.value)"/><br>Room:<br><input class="room" type="text" onblur="this.value=removeSpaces(this.value)"/><br><br>';

				
				document.getElementById(divName).appendChild(titleDiv[counter]);
				document.getElementById(divName).appendChild(formDiv[counter]);
				if (counter >= 2) {
					document.getElementById("add_button").disabled = true;
				}
				if (counter >= 1) {
					document.getElementById("remove_button").disabled = false;
				}
			}

			function removeInput() {
				var title = document.getElementById("title" + counter);
				title.parentNode.removeChild(title);
				var form = document.getElementById("form" + counter);
				form.parentNode.removeChild(form);
				counter --;
				if (counter === 0) {
					document.getElementById("remove_button").disabled = true;
				}
				if (counter <= 1) {
					document.getElementById("add_button").disabled = false;
				}
			}

			function createPeriod(name, code, teacher, room) {
				this.name = name;
				this.code = code;
				this.teacher = teacher;
				this.room = room;
			}
		</script>
 	</body>
 </html>